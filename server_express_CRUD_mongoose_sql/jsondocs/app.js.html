<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const express = require('express')
require("dotenv").config() // Carga variables de configuracion
require('./utils/db') // lanzar BBDD con Mongoose

const pages = require('./routes/pages')
const products = require('./routes/products')
const entries = require('./routes/entries')

const app = express()
const port = 3000


// http://localhost:3000/products?key=123hola



    /**
  * FunciÃ³n hasApiKey
  * @author Alejandro Reyes &lt;alejandroreyespage.com> 
  * @method hasApiKey
  * @param {Object} req - Solicitud http 
  * @param {Object} res - Respuesta http 
  * @param {Object} next - next() para seguir el middleware
  * @throws {error} - Error 403. No se pudo autenticar 
  */



function hasApiKey (req,res,next){
  const API_KEY = req.query.key;

  if(API_KEY &amp;&amp; API_KEY==="123hola"){
    next();
  }else{
    res.status(403).send("403 - Forbidden. You shall not pass");
  }
}

// Motor de vistar
app.set('view engine', 'pug');
app.set('views','./views');

// Middlewares
// app.use(hasApiKey) // Para comprobar Api Key
app.use(express.json()); // para convertir a JSON
// Rutas
// http://localhost:3000/about --> WEB --> vista
// http://localhost:3000/api/products --> API --> objeto
app.use('/',pages); // para las vistas de la WEB
app.use('/api',products) // para la API
app.use('/api',entries)

app.get('*', (req, res) => {
    res.status(404).send("Sorry...404 Not found");
  })

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="entries.html">entries</a></li></ul><h3>Global</h3><ul><li><a href="global.html#hasApiKey">hasApiKey</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Sep 10 2021 11:26:06 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
